% Advent of Code 2025. Day 01: Secret Entrance. 
% gs -DNOSAFER aoc01.ps

/read-input
{                                           % fn
    [                                       % fn [
    exch                                    % [ fn 
    (r) file                                % [ F
    {   
        dup                                 % [ .. F F
        20 string                           % [ ... F F buf
        readline                            % [ ... F (s) 
        {   
            exch                            % [ ... (s) F
        }   
        {   
            exch                            % [ ... (s) F 
            closefile                       % [ ... (s) 
            ]                               % [ ... (s) ] 
            exit    
        } ifelse    
    } loop                                  % Rs
} def 

/left {                                     % z c p r 
    { 
        dup 0 eq                            % z c p r r=0?
        {                                   % z c n r
            pop                             % z c n 
            dup 0 eq                        % z c n n=0?
            {
                3 -1 roll                   % c n z  
                1 add                       % c n z++
                3 1 roll                    % z c n 
            } if 
            exit
        }                                   % z c n 
        {
            1 sub                           % z c n r--
            exch 1 sub                      % z c r n--
            dup 0 lt                        % z c r n n<0?
            {
                100 add                     % z c r n'
            } if 
            dup 0 eq                        % z c r n n=0?
            {
                3 -1 roll                   % z r n' c 
                1 add                       % z r n' c++
                3 1 roll                    % z c r n'
            } if 
            exch                            % z c n' r
        }
        ifelse  
    } loop
} def 

/right {                                    % z c p r 
    { 
        dup 0 eq                            % z c p r r=0?
        {                                   % z c n r
            pop                             % z c n 
            dup 0 eq                        % z c n n=0?
            {
                3 -1 roll                   % c n z  
                1 add                       % c n z++
                3 1 roll                    % z c n 
            } if 
            exit
        }                                   % z c n 
        {
            1 sub                           % z c n r--
            exch 1 add                      % z c r n++
            dup 99 gt                       % z c r n n>99?
            {
                100 sub                     % z c r n'
            } if 
            dup 0 eq                        % z c r n n=0?
            {
                3 -1 roll                   % z r n' c 
                1 add                       % z r n' c++
                3 1 roll                    % z c r n'
            } if 
            exch                            % z c n' r
        }
        ifelse  
    } loop
} def 

/compile {                                  % s
    dup length 0 eq                         % s L?
    { pop {} }
    {
        dup 0 get                           % s D
        (L) 0 get eq                        % s B
        { /left } { /right } ifelse cvx     % s P
        exch                                % P s
        dup length 1 sub                    % P s L-1
        1 exch                              % P s 1 L-1
        getinterval cvi                     % P n
        exch                                % n P
        [ 3 1 roll ] cvx                    % { n P }
    }
    ifelse
} def 

/run {
    0 0 50
    (input.txt) read-input  
    { compile exec } forall
    pop 
} def 

run 
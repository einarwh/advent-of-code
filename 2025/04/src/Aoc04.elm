module Aoc04 exposing (..)

{- Advent of Code 2025. Day 04: Printing Department. -}

import Browser exposing (Document)
import Html exposing (Html)
import Html.Attributes
import Html.Events exposing (onClick)
-- import Dict exposing (Dict)
-- import Array exposing (Array)
import Set exposing (Set)
import Html exposing (text)
import Time

defaultTickInterval : Float
defaultTickInterval = 10

chamberWidth : Int 
chamberWidth = 7 

-- MAIN

main =
  Browser.document
    { init = init
    , view = view
    , update = update
    , subscriptions = subscriptions }

-- MODEL

type DataSource = Input | Sample

type alias Pos = (Int, Int)

type alias Model = 
  { dataSource : DataSource
  , width : Int 
  , height : Int 
  , rolls : Set Pos 
  , removed : Int 
  , paused : Bool 
  , finished : Bool 
  , tickInterval : Float 
  , message : String }

sample : String
sample = """..@@.@@@@.
@@@.@.@.@@
@@@@@.@.@@
@.@@@@..@.
@@.@@@@.@@
.@@@@@@@.@
.@.@.@.@@@
@.@@@.@@@@
.@@@@@@@@.
@.@.@@@.@."""

input : String
input = """@@@.@..@@.@@..@.@@@...@...@@@.@@..@..@@@@@@.@@.@@@.@@@@@@@@@@@@@......@@@@@@@@......@@.@@@@@@@.@.@@.@@@@@.@...@......@@@@@@@@@@@@.@@@@@@@
@@@.@@@@@@@@.@@@@.@@@@.@.@.@.@@@..@..@@@@...@@@@@@@@.@@@.@@@@@@.@..@@@@@.@@.@.@.@@@@.@@@......@@@@@.@..@@@...@@@@@@@@@@.@.@@@@@@@@.@@@@..
..@@@@.@.@.@@@.@@@@@..@@@@.@@@@..@@@.@.@@@...@@@@@..@@@@.@@@@@..@@@@@...@@..@.@@@@.@@.@@.@@.@@.@..@.@@@@@....@@@...@@.@.@@@@@.@.....@@.@@
.@@@..@@.@.@@.@@@@@@..@@@.@@..@@@@...@@@.@@@.@@.@@@@@@.@@@@..@@@@@.@@@@@@@..@@....@@.@....@@@@@.@@.@@@..@@@@.@.......@@@@...@@@@.@..@..@@
@@@..@..@@@@.@.@@@@@@..@@@@..@.@.@@@.@..@@@@@.@...@..@..@...@....@@..@@@...@@@@@.@.@........@..@@.@.@@...@@@@@.@@@@..@.@@@@...@..@@.@@..@
@.@@.@.@..@@@@.@.@@@...@@@..@.@.@@..@.@@@......@..@...@.@@.@@@.@@@.@@@@..@@.@.@@@@.@..@..@.@@..@@@@.@@@@@@@@@@@@..@@@@..@@.@.@@..@@..@..@
.@...@@......@..@@@@@...@@@@@.@@@.@@@@@.@@..@@@@@@@.@@@@@@@@@.@.@..@@@@...@@.@...@@@@@.@@@@@...@.@.@.@@.@@.@.@@.@@@@.@@@@@@@@@.@.@.@...@.
.@@@...@@@.@....@@@@@@@.@@@.@@@@.@@...@@.@@@@@@...@@@@@..@.@...@.@@..@@..@@@@@@.@@@@@@@@@@..@.@@..@..@.@@..@@.@@@@@@@@...@....@.@@@@@@@@@
.@..@@@@@@@@.@@@.@@@@@@@.@@@@@.@.@.@@@@..@..@@@..@@@.@@@@.@@.@@@@@..@@@.....@@@.@.@@@@.@@.@.@@@@.@@...@.@@@.@@@@@@@@@..@.@..@@@@@@@.@@@@@
.@.@@.@.@@@@@@@@@@@..@@@@@@....@@@.@.@.@@@.@@@@@@@@.@@@@@@@..@@..@@@..@@@...@.@@@@..@@@@..@@@@@@@@@@@@.@@.@@@@@@@@@@..@.@.@.@@.@@.@....@.
@@.@@@@@..@.@.@@@@@@..@@@.@@.@.@@..@@@@.@@..@@@@@@@@.@@@@@@@.@@@@@@@.@@@@...@@@@.@@@@@@@.@@..@@.@.@@@@@.@@@@@@@.@@@@@@@@.@.@.@.@@@@@@@@.@
..@@.@..@@.@..@.@.@.@@...@@@...@.........@@.@.@@@.@.@@.@.@@.@@@@@@@@.@.@.@@.@@.@@@@@@@@.@@..@@@@@.@@.@@@@@@.@.@.@@@.@.@.@.@@@.@@.@@...@@@
.@@.@@@..@..@@@....@@@.@@@@@@@@..@@@@..@@.@@@@@..@@.@..@@@@@@@.@@@@@.@@@@.@@@@@@@@@@@.@..@@@..@@.@.@@....@@..@@.@@...@..@@@@@@@..@.@@@@@@
.@@.@@@@@@.@@@@.@.@.@..@@@@.@..@@..@.@@@@@.@.@@@@@@@@@.@@@..@.@.@.@.@@@@@@@@@@@@...@@.@@@@@@@..@.@.@@@..@...@...@@@@.@@.@@@.@.@.@@@...@..
@@.@..@@..@@..@.@@@.@@@@.@@@@@@@..@.@@.@@@.@.@.@@@@@@.@@@.@.@@@@@@.@@.@@@.@@@@@@@@@@@@@@@.@.@@@@@@..@@@@..@@.@@.@@@@@.@.@@@@@.@@@@.@@@@@.
@@@@@.@.@@@.@@..@@.@.@@@@@.@@@..@@@@@@..@...@....@.@@..@@@@.@@@@.@..@@.@@.@@@@.@..@@.@@@@..@@@@.@.@@..@@@@.@.@.@.@@@.@@@@@@.@@@@.@...@@@@
@@.@@@..@..@.@.@@@@@@@@@@@....@@@@@@@.@.@@@....@@.@@@@@@@@@@..@@.@@.@.@.@..@@.@.@.@...@@.@.@@@@.@@@@@@@@@@@...@.@..@.@..@@@.@@@.@..@@@@..
.@..@@@..@@.@@.@..@@@@@@..@@@@.@@@@@@@@@@@@.@.@.@@@@@@.@@.@@@@.@@@.@..@@@@@.@@@@@.@.@.@@@@@@.@.@@.@.@.@@@@.@..@@@.@@.@@@.@@.@@@@..@...@@@
@@....@@.@.@@....@.@@.@@@@@@@@@@@@@..@.@..@@@@.@@.@.@@.@.@@..@..@@@@@@@@@@@@@@@@@@..@.@@@@@@.@..@@@@@.@.....@@@..@...@@@@..@@@@.@@.@@.@@@
.@...@@@.@@.@.@@.@@@@.@@@@....@@@@@.@@@@@@@@.@@.@@..@@@@.@@.@@@@@.@.@.@@.@.@@@@.@.@@.@@@@..@@@@@@.@@@@.@@.@@..@@@@....@@@@@@.@@.@@@@@@@.@
.@@.@@@@@@@.@@@.@@.@..@@@.@@@@@@@.@@@@..@@@@@@...@@@..@..@@@@@@@.@@@@...@@@@@..@@@@@@..@@.@@.@@.@@@@@@@@@.@@@@@.@@...@@@@@@@.@@..@.@.@@@.
@@@@@.@@.@@@.@@@@@@@@@@@@.@.@.@@@@.@@.@...@@@@@@...@@..@@@@.@@@@@@@.@.@@.@@@.@...@.@.@@.@@.@@..@@@@...@@.@@@@.@@@@@@@.@@@..@.@...@@@@@...
..@@@@@@.@.....@.@..@@.@@@.@@@@.@@@@..@..@.@@....@@@@@.@..@@..@@..@.@@.@@@..@...@@..@@.@@@@@.....@@@@@@@@@@@@..@@@@@@@..@@@.@@.@@.....@@.
@@@@@.@@.@@.@@.@@@@@@.@@.....@.@..@..@@@@@@.@@@.@@@@@@..@@..@@@.@@@@@.@@@...@..@@@...@@@@.@..@@@@@...@@..@.@@@..@.@@..@@@@.@.@.@@@...@.@@
@@@@@@@@@@@..@@@@.@@@..@@.@.@@@@@@@.@@..@..@@@....@@@@@..@.@..@@@@@@...@@..@@@@@@@@@@@.@..@..@@@....@.@@@..@@@@..@@....@.@.@@@..@.@.....@
@.@@.@....@..@@@@@@@@@@@.@........@.@@@@@@@@..@..@.@@.@.@@.@@@..@..@..@...@@@@@@@@.@..@@@...@@@@@@@@.....@@@..@@@.@@@.@@.@@..@.@@.@@@@@@.
.@@@..@@@@..@@.@.@@@..@.@@.@@@@@@@@@@.@@...@@@@@@@@@...@@..@@.@@..@@@@@.@@@@..@.@..@.@@@.@@.@@@.@@@@.@@@@@@.@@.@@@.@@..@.@@@.@.@@@@@.@@@.
@@@.@@.@@.@..@..@....@.@@@@@@@..@@.@@@..@@@@@..@@@@@...@...@@@@.@@@.@..@@@..@..@@@@@.@@.@@@@@@.@@@@@.@@@@..@..@@@.@@@@.@@...@..@.@..@@@.@
@..@.@.@@@.@@@@.@.@@@.@.@@@@..@@@@.@@...@@@....@@..@@.@@@@@@@@.@.@@@@@..@@@@@@@@...@.@.@@@.@@.@...@@@@@.@@....@@.@@@@@@....@.@.@@@@.@.@@.
@@@@@@..@@..@.@.@...@@@..@....@..@@..@@@@@@@@..@.@...@@@@@@@.@.@@.@@@.@...@@.@@@@@..@@@@@@..@@@@@.@@@.@@@@@@.@@...@@@@@.@.@.@@@@..@.@@..@
@...@@@@@@@@@@@@.@@@@@@@..@..@.@@@@@..@@@..@@...@..@@.@.@.@@@.......@@@@@....@...@@@@@@@@@@@.@.@.@.@@@@@@.@@@.@@....@@@.@....@@@@@@@@.@@.
@@.@@@.@@.@.@@@@.@.@.@@@.@.@@@@..@.@@@@@@@@@.@.@@@@.@@@..@...@@@.@.@.@.@@@@@@.@@@@@.@@@..@@@@.@.@@@@@@.@@@@@.@@..@@@@@@@@@@.@..@@@@@@@@@@
@@.@..@@@@@.@@@@.@@@@@@@@@@@@...@@@@@.@..@..@.@@@@@@@@..@.@@@@@..@.@@@@.@..@@..@@@@@@@@@@..@@@.@.@@@@@@.@@@@.@@@@@@@@@@@@@.@@@@..@@@@@@@@
.@.@@@@..@.@.@...@@@@.@..@@@@@@@@@...@@@..@.@@@..@@@@@@@@@...@@@@@@.@@@.@@.@@@@@..@@..@@....@@@@@@@@.@@@@.@@..@@@@@@.@.@@@@@.@@@@@.@@@@@.
.@@@@@@@@@..@..@@@@.@.@.@@@@.@@@...@@.....@.@.@@@@@@@@@@@@@@@@.@.@..@@.@.@@@..@@..@@@@@@@.@@.@@@.@@@@@..@@.@@@@@@@@@@@@..@@@@.@.@.@.@@@@@
@@.....@.@@@@@@.@@.@@@@@@@@@@@@.@@@@@@.@@@@@@@@...@@..@@.@@.@@@@@@@.@@@.@.@@@...@@@@@@@@.@@@@@@.@@@@.@@@@@@@@.@@..@..@..@@@....@.@@@@.@@.
@....@..@.@..@.@@@@@@.@.@.@@@@..@.@@@...@@@.@..@.@@@@...@@@@@@@.@.@.@.@@@@@@@@@@@..@.@@..@@.@@@@@@@@...@@@.@@..@.....@@@@@@@@@@..@@.@@.@@
..@@@...@.@@.@@@.@@@...@..@@@@@.@..@@.@.@@@.@@@.@@..@@@@@@@@@@@@@.@@@@@..@.@.@@@@@@..@@@@..@@@...@.@@@@....@...@@..@@@..@@@@@..@..@.@@...
.@@@@@@@@.@.@@.@@.@@@@@.@@.@........@@..@@@.@.@@..@@..@@@@.@@@@@.@@.@@@@@@@.@@@.@@@..@@....@@...@@@.@.@.@@@@@@@@.@@@...@@@@@@@@@@.@..@@..
@.@@.@.@@@@.@.@.@@@@@..@.@.@...@@@.@.@.@.@@@@@@@.@.@@.@@@.@@@@@.@@@@@@.@.@@..@@@..@.@@.@@..@.@@@@@@@@@@.@....@@@.@@@@@@@@@@@@@@@...@@@@..
@@.@@@..@.@@...@@.@@@@.@@@@@.@.@@.@@@@@@@@@...@@@@@.@@@@@@..@.@@..@@@.@.@@@..@@.....@.@@.@.@.@..@..@@@.@.@@.@@@@@@@.@.@@....@@.@@@@...@@@
@.@@.@@@@@..@@@@.@..@..@@.@.@.@...@@.........@@.@.@@@@.@@..@@.@@.@@@.@.@.@@.@@.@@..@.@@.@.@@@@@@@@@@@..@.@@@.@@.@@@@@@@.@.@@...@..@@@...@
@.@@@...@@.@@.@@@@.@@..@@@.@@.@@......@@.@@@..@@.@@..@@@@@.@.@.@@....@..@@@..@@.@@.@@@@@@@.@@@@@@@@...@@@@@@@@@@@@@@@...@...@..@@.@.@@@@@
@@@@.@@.@@@@@@@@@.@.@@....@...@@.@..@.@.....@@@.@@....@@..@@..@.@.@@@@....@.@@@@@@.@@..@@.@@@.@@@.@@@@@@@@@@@..@.@@..@.@.@@@@@@.@@@@@@.@@
...@@..@..@@@..@.@@@@@@@.@.@@@.@.@@@.@.@@@.@@.@@@@@..@@.@...@@@..@.@@@@@@@.@.@@@.@@@@@.@@@@@@@@.@@.@.@@@@@.@..@.@@@@@@@@@@.@@...@.@...@@.
.@@@@@@@@@@..@@@@.@@.@.@@@.@@.@@..@@@.@@@@@.@.@@@..@@@@@@@.@@@@@..@@@@@.@@.@@@..@@@@@.@@@.@..@..@...@.@.@.@@.@@.@@@@@@@.@@@@@.@@.@@@@..@@
@..@.@.@@..@.@@@@@.@.@@.@..@@@.@@@@..@..@@@@@..@@..@@@@..@.@@.@@.@@@@@@@@@@@@@@......@...@.@@@@.@..@.@.@@...@@@@@@@.@.@@.@@.@@@....@.@@@@
@@@@@@@@@@.@@@..@@.@@@.@@.@..@@.@@.@@@@@@...@..@.@....@.@@.@@@@@@.@@.@@@.@@.@@@@@......@@.@@..@@@.@.....@@@@@@@@.@@..@@.@.@.@@..@@.@....@
@@.@@@..@@@.@@@@@@@@@@...@@.@.@.@@.@@.@.@....@@@.@@..@....@.@@.@..@@@.@@@.@..@.@..@..@@@@@@@@@.@.@.@.@...@@@@.@.@@@.@...@@@@@@..@@...@@@@
@@@@.@@.@@@.@@@@@@@@@@@...@@.@@..@.@@@...@@.@.@.@@@@@@.@@@@..@@@@..@@..@.@.@@@@@.@.@@@@.@@@.@@@.@.@@@..@@.@@..@.@@@@@@@.@@@..@@@@.@.@@@@@
@...@@.@@@@@@.@.@@@@@@@@@@@@@@@@@@..@@..@@...@@.@.@@@@.@@.@@@@@@@.@.@.@@.@@.@..@.@@@@..@@@...@@.@.@@..@@@....@@.@..@...@.@@@.@@@@@@@...@@
@@..@..@.@.@@@@.@@@..@.@@@@@@@@.@@@.@@@.@@@.@@..@@.@@@@.@..@.@..@...@@.@@@@...@@@@@..@@@..@...@.@@.@@@.@.@@@.@.@....@..@.@@@@@@@@.@@.@@@@
@@@@@@..@@@....@@.@.@...@@@@@.@..@@@@@@..@...@@.@@@@@@.@.@@.@@@@.@.@.@@@@@@.@.@@@@@@@@.@...@@@@@@.@.....@@...@@...@@@@@@@.@@@@@@@@.@.@@..
@@@@@@@@...@@@@..@..@..@@@..@@.@@@@@@.@@@..@@@@.@@.@..@..@.@@.....@.@@..@@@....@@@@@@.@@@@@@@@@@@@..@.@@@@@@@@....@.@@@.@@@@@@@@@@@..@.@.
@@@@@.@..@.@@.@@@@..@.....@.@@@.@.@.@@@.@@@@@..@@.@@@@@@..@@.@.@@@...@@.@.@@..@.@.@@..@.@.@@@@@.@@..@..@@@...@@@.@@@@@@@@@...@@@.@@..@@@@
..@@...@@@@@@@@@@.@.@.@..@@.@@@@@@@@....@@@.@..@@@@.@@@@@.@.@@@.@@.@@.@@@@@@@@@..@@.@@@@@@.@@@@@@@..@@@...@@.@@@@@@@@.@.@@@@@@.@@@@......
@@...@...@@@.@..@@@.@@@@@@@@@@@@@..@.@@.@@@@@@@@@@.@@.@@.@@.@@@@.@.@@..@@@@.@@.@@.@...@.@......@@.@..@.@@@@@@.@@@@@@....@.@....@..@@@@..@
@.@@@@@@@@@.@.@@@@@@@@@@@@..@.@@@@.@@.@@.@.@@@...@@@.@@@.@@@@..@@@@@@@@..@@.@@..@.@@.@@@.@.@@@@.@@@.@@@@@@.@@.@@.@@@...@@@@@@.@@@@.@@@.@.
@@@.@@@@@..@@@@@@.@.@@@@.@@...@@@@@.@@@@.@.@.@.@@.@..@@..@@@@@@...@@@@.@..@@@..@@.@@@.@@@@@@@@.@@@@@@.@@.@.@@@@@@@@@@@.@.@@..@@@@.@.@.@..
...@@@..@..@@..@@@@@@@..@@.@@@...@@.@@@@@@.@@@@@..@@@.@@@@@@@@@.@@@@@@.@.@.@@@@@..@@@@@@.@@.@@@@.@.@@@@@@@@..@@@@@@.@.@.@@.@...@@@@@...@.
.@@@....@.@.@.@@@@.@@@@@@@.@@@@.@.@@@@@@.@@@@.@@@@..@@..@..@@.@...@@@@@.@@@@@@@@.@@@@@@.@@@@@.@@@@@@@..@.@@@@@..@.@@@@.@@@@..@@@@@.@.@.@.
..@..@.@..@@@@@.@..@.@.@@@@@.@@@@..@.@@@@@...@.@@.@@@@.@@@@.@.@@..@..@....@@.@.@@..@.@@@@.@.@@.@....@.@@.@@..@..@@..@@@@@@@.@@.@.@@@@....
@..@.@...@@.@@@@.@@..@@.@@..@@.@@@@@@@.@@@@@@@.@...@..@@@@..@@@@.@...@..@@@@.@.@@@@.@.@...@.@.....@.@@.@@@@.@@.@@@@@@@@@@.@..@@@.@.@@@@..
@@@@.@@@@..@.@...@@@@.@.@@.@.@..@.@@@@@.@@.@@@.@@.@@....@.@@@@...@@@..@@@..@@@@@@@@@@@@.@@@..@@@@.@@@@@@@@.@.@@@.@..@@.@.@@@.@@@@..@@.@@@
...@.@.@.@@@@@@@@.@@@@@@.@@.@@.@.@...@...@@@@@..@.@@@...@@@.@@@@@.@@@@@@@@@@@.@..@@@..@@.@@@@@@@@...@@@.@@..@@@@.@@@@.@@..@@@@@.@@@@@@..@
@@..@@@@.@..@.@.@@@....@@.@@@@..@...@...@.@@..@@....@@.@@@@.@@@..@...@@@.@@@.@@.@..@@@..@..@@@@@@..@@.@@@@@@@@@@@.@@.@@@@@...@@@@.@@.@@@.
@@@@..@.@.@@..@@@@.@@@@.@@@@@@.@..@@@.@@.....@.@@.@@.@.@@@@@.@@@@..@.@@..@...@.@@@@@@..@.@@..@..@@@@@.@@@@.@...@@..@..@@.@@@@.@.@@@@@.@..
@.@..@@@..@@.@@@@@.@@@...@@@@@@.@@@@.@.@@@@@@@@@@@.@@@@.@@@@@@.@@@@@....@@..@@@@@@@...@.@..@@@.@.@..@@@..@@....@..@@@@@.@@@@@@.@@@@.@@@@.
@@@....@@@.@@@.@.@@...@@@..@@.@.@@.@@@.@@@@@@@@@.@@..@@..@@@@..@@@.@.@@..@..@@.@.@@@..@@@@@@@.@@.@.@@@@@.@@@@.@@@.@@@.@.@@.@@@.@@@.@@@..@
@.@@.@@@@@@@.@@..@@@@@@..@@@@@@@@.@@@@.@@@..@@.@@@@@@@@@@@.@@...@@@@.@..@@@.@@@@@@@@@@@@.@@@@@@@@.@.@@@@@@.@@.@@@@@@@@.@....@.@@@@.@@.@..
@.@@..@@@@@@@.@@@@@@.@..@@.@..@.@@@.@.@@@..@@@@@@@@@@@@@..@@@@.@@.@@@@.@@@@.@..@.@@.@.@@.@@@..@.@@@@@.@@.@@.@@.@@@.@@.@@@@@..@@..@.@.@@@.
.@.@..@.@@@@@@@@@@@@@@..@@@@..@@@.@@@@@.@@@.@@@@@@.@..@@@.@.@@@@@@.@.@@.@.@..@.@@@@@@..@..@.@@@@@@@@@.@@.@@....@.@@.@@@.@@@.@@.@@@@.@@@@@
...@@@.@@@.@.@.@@.@@@@@@@.@..@.@@@@.@.@..@@@@.@@..@@.@@@@@@@@.@@@.@@@@@...@.@@.@..@.@@@@@@@@.@.@@.@.@.@@@.@@@@@@.@...@..@.@@.@..@@@@@.@@@
@...@.@..@...@@@.@@...@.@.@.@@@.@.@@@@.@@.@@@@..@@.@@@@..@....@..@@...@.@@@@@@@@.@.@@@@@...@@@...@@@@@.@.@@..@@..@@@.@.@@@@@@@@.@@@@.@@@.
.@@@..@@.@@@@.@.@..@@@@.@.@..@@.@.@@.@@.@@@@@@.@..@@..@@.@@@@..@@@@@@@@..@@@..@@@@..@@@@@@@@@@.@.@@@..@@@@...@@@@@.@@@.@@@@@@@@....@@.@@.
@@@.@@..@@@.@.@.@.@@..@@@..@.@@@.@@...@@.@@.@@@@.@@@@@@.....@@@@@@.@@.@...@@@.@@@.@.@@@@.@@.@..@@.@@.@@@..@..@@.@@@..@.@@@@.@.@@@@..@.@@@
@@@.@@@@@@@.@@@@@.@.@@@@@@.@@....@@@.@.@@@@..@@.@@@@.@@...@.@@.@@@.@.@...@@@.@@.@@.@.@@.@....@@.@@@..@@@@..@@@@@.@@.@@@@@@@@@@@..@@@@@@@@
@..@.@@@@.@@@.@..@..@@@.@@@@@@@.@.@...@..@.@@@..@.@@@.@@@@@.@@@@@@@.@@@.@@....@@@.@@..@.@@@.@.@@.@.@.@@@.@.@.@@..@@@@.@@.@@.@@@@@@@..@.@.
@.@@@.@@.@@@@..@.@@@....@@@.@@@@.....@@@.@@...@....@.@.@@...@@@...@.@@@..@@@@.@.@@@@@@@@.@@@@.@.@..@@.@@@.@..@@.@@.@@.@@@@...@.@@@@...@@@
.@@@@@@@@@@@@@.@@@@.@@@@..@..@..@@@.@.@@.@@@..@@@..@@.@@.@@@@@@.@....@.@@@@@@@@@@.@@...@..@@..@@.@.@@@.@@@@@.@@..@@@..@@.@@@.@.@@@...@..@
@@@@@@.@...@@@...@.@..@@@@.@..@....@@@.@.@...@@.@@@..@.@@...@.@@@@..@@.@@@.@@@.@@@@@@@@@@@@@..@.@@.@@@..@@@@@..@@.@@.@@@@@@@@..@.@@@@.@@@
@@@@.@@...@@@@@..@.@@@@..@@.@.@@@@@@..@@@.@.@.@@@@..@@@@@...@@@.@@@..@.@.@@.@.@@.@@...@.@...@..@@@@@@@@@..@@@....@@.@.@@@@.@.@.@@..@@@@@.
.@@@.@@@.@@.@@@.@@..@@@.@.@..@.@.@.@@@@@@@.@.@@..@.@..@...@.@@@.@.@@@@..@@@..@@@.@@@@@@@...@@...@.@@..@@@@@@@@@.@@@@@@@@@@@.@@@@@.@.@.@@@
@.@@@@.@..@@@@.@@@@@.@@@@@@.@@@@.@.@@.@.@.@@@@@@@...@..@@@@@@@@@@.@.@@@..@.....@@@@...@....@@@@@@.@@@@@@@.@.@@.@.@....@@@@...@@@@..@.@@@.
@@@@@.@.@@@..@@.@.@@..@@@.@@@@@.@...@..@@@.@@@@.@@..@@.@..@...@.@@@.@.@@@.@@.@.@..@.@..@.@@@..@.@.@@@@.@..@@@.@@@@.@.@..@@@.@@@.@@@@@.@@@
@..@@@@.@.@.@@@@@@@@...@@@@@@..@@@..@@.@@..@@@@@..@@@@@...@.@.@@@@..@@@@@..@.@.@@@@.@.@@@.@@@..@..@@@.@@@..@.@.@@@@@@@@@@.@@.@...@@@@@@@@
@.@@.@@.@..@.@@@.@@.@.@@.@.@..@@@@.@@.@@@@.@@@@@@@.@@@..@.@@@@@..@.@@@@@@...@@@.....@.@.@@@@@@@.@@.@.@.@@@...@@@@@@@..@@@@.@@@.@@@@.@@@@.
@@@@.@..@.@@@.....@@@.@.@@.@@@@@.@@@.@@@@...@@.@.@.@@@@..@.@...@@@@@@@@@..@@.@@@@.@@.@@@@.@@..@@@..@.@@@@...@@@@.@..@@@@@@.@@.@..@@@.@.@.
@@@.@@@@@.@@.@@.@@@@@@@@.@@..@.@@...@@.@@..@.@@@@@@.@..@.@@@..@@@.@@.@@.@....@@......@@.@@@..@@@..@@.@@@...@@@@@@@.@....@@@@.@@@@..@.@@..
@@@@@@.@....@@.@@.@@@...@@.@.@@@.@.@@@@@.@@@.@..@@@@@@.@..@@@.@@@.@..@@.@@@@@@..@.@@@.@@@.@.@@@..@.@@...@@@.@@.@@@@@@@@.@@@@.@..@@@.@..@@
@@.@.@.@@@@@@@.@@.@@@..@@.....@.@@.@@@.@@@.@@@@@@@@@@.@.@.@@@.@@.@.@..@@@@@@@@.@..@..@@@@@@@@@.@@@@@@..@.@..@..@@...@@@@.@.@@@..@@@@.@.@@
.@@@@@.@.@@@@@@@@@@@@@.@@..@@@@@@..@@.@@@@@@@@.@@...@@@@@@.@.@.@@@..@@...@@.@.@@@@@@@@@.@@...@@@@@.@@@@@..@@@@@@.@@@...@@@.@@@@@@@@@@....
@@@@@@.@.@.@.@@.@@.@@@..@..@@.@@..@@@@.@@.@.@.@@.@@@@@@@@..@@@.@.@.@.@@@@.@......@.@.@@@@@@@..@@@@@@.@..@@.@.@.@@..@..@@@.@@@@@@.@@@@.@@@
....@@@@@@@@@@@@@@@.@@..@@.@@@@@..@...@.@@...@@..@@@@@@@@@@@@@.@.@.@@@.@.@@.@.@@@.@@@@@@@.@@@@.@@@@@.@@@@@@@..@@@@@...@...@@.@@@@@@..@@@.
@@@.@@@.@.@@@@@.@@@@@.@@@..@@..@@@@@..@@@@.@@...@@.@..@..@@@@....@.@.@@.@@@@.@....@@@.@@..@@..@@@@.@@@@@..@@@...@@@.@@@@@@@@@@@@.@..@@@.@
..@.@.@@@@..@@@@..@@@@.@@@.@..@@.@@@@@@.@@.@.@.@..@@@@@.@@@@..@.@..@.@@@@@.@.....@@@...@.@@@@..@..@..@.@@.@.@@@.....@@.@@.@@...@@...@@@@.
@.@@@..@@....@..@@.@@.@.@@.@.@.@@@.@@@@@....@...@@@.@@@.@.@@.@.@@@@@@.@@@.@@.@@@@@@..@@@@.@..@.@@@.@.@@@...@.@.@..@@@@.@@@@@@.@.@@...@@@@
@@.@....@@@@@..@@@..@.@@.@@@..@@@@@@@@@@@@@@@....@@.@@@@.@@@@.@.@.@@.@.@.@@@@@@@@.@@.@@@@@@@..@.@@@@@@@.@...@@@@@@@....@@@..@....@.@@@.@@
@.@.@@@@@@@@@.@@@@@@.@...@@@.@@@..@@@@.@.@@.@@@.@.@@.@@@@@.@@@.@@@@.@@..@@.@.@@.@@.@@@.@.@@@@..@@@.@@@.@..@@@@@.@@..@@..@@...@@@@@@@@@@.@
.@@@@@@@@@.@..@@.@@@@..@..@@@@@.@@...@.@@.@.@@@@@@@@@.@@@@....@@.@@@@@...@...@.@@@@@.@@@@@@.@..@@..@.@@@@@.@@@@.@@@@.@@.@@@.@@.@...@@.@@.
..@@@@@@@.@@@@@@@@@@@@@@..@@@.@@@@@@..@@@.@@.@@@@@@@@@@@.@.@@..@@@@@.@@@.@.@@@@..@...@@.@@@@.@@@@.@@@@@..@.@@@@.@@.@.@.@.@@@.@@.@@@..@@@.
@@@@.@@@@.@@.@@@@@@@.@.@@@@@@.@.@.@.@@..@@....@.@@@@@.@..@.@@...@.@@@@@@@.@.@@@.@.@@.@@...@@@.@..@@@@@@...@@..@@@.....@.@.@@@@@@...@@@@@@
@..@..@@.@@@..@@.@@.@.@@@...@@.@@@.@@.@@@.@...@@@@.@.@@.@@@.@..@@@@.@@@..@@..@@@@.@.@..@..@@.@.@@@.@...@@@.@@@@@@@.@@@.@.@..@..@.@@@@@.@.
@@@@..@@.@@@@.@@@@...@.@@@@@@@.@.@@.@@@..@@.@@@@@@@@@@@.@@@..@.@@@.@@@@..@@@@.@@@@.@..@.@@@..@..@@.@@@@@@.@..@@@@@@@...@.@@.@...@.@.@@..@
@@.@@..@..@@@@@@@@@@@@@@..@@@@@@@.@@@@@...@@@..@@.@@..@.@@@@@@@@..@@.@.@@.@@@@@...@@@@..@@@@@@@@@@@@.@@@..@..@@@@.@@@@@@.@@@@@@@.@...@@@@
@@@@@.@@.@@...@.@.@@@@@@@.@@@....@@@@@@@..@@..@..@@@@@..@@@.@@@@@@@@@.@@.@.@@@.@@...@@@.@@@.@@.@@@.@..@@@@@@.@@@@@@@@@@@...@.@@@@@@.@@@@.
.@@@@@@.@@@@..@..@@..@@@.@@@@...@@@@.@..@@.@@@@.@.@.....@..@.@@...@@@@.@.@..@@@@@@@..@@@@@@@@@@@@@.@..@@@@.@.@..@@@.@@@@@@..@.@@..@.@@.@.
@@@.@@@@@...@@@.@@@@@.@@@@@@...@@.@@.@@.@@@@@@@@.@@@@@@.@@@@..@.@@.@@@@@@.@.@@.@@@.@@@@.@@@@@@@@.@@@@@@@@.@@.@@@.@.@@@@@@@.@.......@.@..@
@@@@@@.@..@...@..@..@@@..@@@@.@@..@@.@@@..@@.@@@@.@@@@@...@.@@@.@@@@..@...@@@...@.@@@.@@@@@@.....@@@@..@.@@@.@@@@@@@.@@@.@.@.@.@@....@..@
@@@..@@@.@..@@@@....@.@@@.@@@@.@@@@@@@.@@@.@@@.@@.@@@.@@@@.@@@@.@@@@.@@..@@@@@@@...@@@.@@@@@@@.@@.@.@@@@@@@@@@@@@@@@@@@.@.@@@@.@@@.@.@@@.
@..@@@@@@@@@@@@@.@.@.@@@@..@.@@@@@@.@@@@..@..@@@@.@@..@@.@@@@@@.@@@@.@.@@@@@.@@@@@@.@@.@@...@@@@..@@@@@@@@@.@@@.@@@@@@@@@@.@.@@@@@@@@.@@@
@@....@..@..@...@@@@.@...@@@.@@.@@@...@..@.@@..@@@.@@@@@@...@.@@@.@@@@@.@@@@...@@@@.@@@@.@.@@.@@@@@@@.@.@..@@@@@@@@@@..@.@@@@.@..@@@@@@.@
.@.@@@@@@@@..@@.@@@.@.@.....@@@@.@@@@@@..@...@@@@.@.@@....@.@@@@@.@.@@@.@..@.@@@@@@@@@.@@@@@@@@@@@@.@.@@.@...@@@@.@.@..@.@@@@.@..@@.@@@@.
@@@@@.@.@@@@@@...@@@@@@@@@@@...@...@.@...@..@@.@.@@@.@.@..@@@@@@@@.@.@@@@@.@@@@@@@@@.@....@@@@@@.@@@@@@@.@@@@.@@@@@@@@@...@..@@...@@.@@@@
@..@.@.@.@@@..@@@..@@@@@@.@@@@@@@@@.@.@.@.@@@......@..@@@@.@@@.@@.@@.@....@.@@@...@.@@@.@@@.@..@...@@@@@@@@@@@@@.@.@@@.@@@@@@@@@.@@@@@@@@
..@@.@@@@@@@@@..@@...@..@@@@.@@.@@@@@@.@@.@.@..@@@@@@@@...@@@@@.@@.@@@@@.@.@@@.@@@@.@.@.@..@@@@@@.@@@@@@.@.@@@@....@@..@..@@..@@..@@@.@@@
@@@.@@@@@@@.@@@@@.@@.@.@@.@@@@..@@.@@@@@@...@@@@@@..@.@@@.@@.@@@@@@@@@@@@@....@@@@..@@@.@@@@@@@@@.@.@@@@@.@@@@@@@@.@@@@.@..@@.@.@.@.@@@@.
@.@@@@@@@@@.@@.@@.@@@@@..@.@@@.@..@....@@@@.@.@@@@.@@.@.@@@..@@..@@.@@@@@@@@@@@@..@.@@@@.@....@@.@@@@@@.@@@@@@.@.@@@@@.@.@@.@@@@.@@..@.@.
@.....@.@@@.@.@...@.@.@@@@@@@@@@@@..@.@@@@@@@@@@@@.@@@..@@@..@@@.@@@@@.@@@@@@@@@@@@@..@@@@.@..@@@@..@@..@@@@@@@@@@..@@@@@..@@@@.@@@@@.@@.
.@@@@..@.@@@@@...@@.@@@.@@@@@@@@@@...@..@@.@.@..@@@@@@@...@@@@@@@.@.@....@.@.@@@.@@.@@@@.@@.@.@@@@@@.@...@@@@.@@@@.@.@@@.@@.@@.@@@@@.@@@@
.@@@.@@@@@@@@@.@@@@..@@@.@..@@.@@@.@@@@@..@@@..@..@.@.@@@....@@@..@.@.@@.@@.@..@@.@@@@.@@@@@@.@...@.@@@@@.@.@..@@@..@.@...@.@@....@@@@@@@
@@.@.@@@@@.@.@..@..@@@@.@@.@@..@@@.@@.@@.@@@.@.@@@...@..@.@@..@@@....@..@@@.@@@@@@@@@@@@@@...@.@@..@@@.@@...@@.@@@..@@@@@@@......@.@@@@@@
@.@@@..@@.@.@@@.@.@..@.@...@@.@@..@@@@@..@@....@@@@@@.@.@.@@@.@@@@@@@@@@@@@@.@@.@@@@@@.@.@@@...@@@@.@@..@...@.@@.@@@@@.@@@.@@@@@@@.@@..@@
.@.@@.@@@.@.@@@@@@..@.@.@@.@@@.@@@@@...@@@@@@@@.@@@....@...@@.@@@@.@...@@@.@.@@@@.@@@@.@@@@@@.....@...@.@@@@@..@..@.@.@...@..@@..@.@@@@@.
@@@@.@@.@@@@@@@@@..@...@@@@@@@@..@@@.@@@@@@@..@@@.@@@@@@@@@..@@@@@.@@@@..@@@@@@@@.@@@@@@@@@@@@@@@@@@@@@@.@@..@@@@@@@@@@@@.@@@@@.@@@@@.@.@
@@.@@@@@.@@@@..@.@@..@.@@@@.@..@@@@.@@@@@.@@@.@...@@.@@@@@..@@@.....@.@@@@.@.@@@@@@.@@..@..@@@@.@@@.@@..@.@@.@@...@.@@@@.@@@@@...@@.@@@.@
@@@@@@.@.@.@@@.@@.@@..@@.@@.@@@..@.@.@..@@.@@@@@@@.@.@@..@@@@@@@@@.@.@@..@@@@@@@@.@.@.@@@@@@@@@.@@...@@@.@@@@....@@.@@.@@..@@@.@.@.@@@.@.
@@@@@...@@..@.@@.@.@.@@...@@..@@@@@@@@@.@@@.@@@.@@...@@@@.@@@.@@@@.@@..@@@@...@.@@@@.@.@@......@@@@@@@..@@@.@@@..@..@@@@@.@@@.@@.@@....@@
@..@@.@@@@@@@@....@.@.@@@@@@....@@@@.@.@@@.@.@@@@@@@.@@@@@@@..@@.@@@.@..@@@@@@.@.@..@@@.@@.@.@@@@@@@....@@.@.@@.@.@.@@@.@@@...@@@@@.@@@..
.@@@@..@@@@.@.@@.@@@@....@@@..@.@.@.@.@@@@@@@@.@.@.@@@.@@.@@..@@.@@@@.@..@@.@@..@@@.@.@.@..@@...@.@@@@@.@..@@@@@.@...@.@@@@@@@@@@.@.@@..@
.@...@.@@@...@@@.@@@.@.@@@@@@.@.@@@@@...@@@@@@@@@@@..@@.@@@@@@...@@.@.@@@.@.@@@.@@@..@@@@.@@.@.@@@@.@@@.@@@@@@@@@@@@.@@@@@@@@@@@.@@@@@.@@
@.@@@.@@@@@@.@@.@..@.@@.@@.@@..@.@@...@@@@@@@@.@@@..@.@.@.@@@.@@.@@@.@.@@.@@@@@....@@@.@@.@@.@@..@@@..@@@@@@.@@@@@@@@@@@@.@@.@@@@@@@@@.@.
@@.@@@@@@.@.@@...@@.@@@@..@.@.@@.@@@.@...@@@@..@@.@@.@@.@.@@@@..@.@@@@.@@@..@@.@.@.@@@@@@@@@......@@.@@@@@@...@.@..@.@@@@@..@..@.@@.@@..@
@@@@@@..@@.@@@@..@@@.@@@@@..@@@.@@@@@@@.@@@@..@@@@.@@@.@.@@@@@@..@@@....@@@...@@@@@.@.@@@@.@.@.@@@@...@@..@@..@@@@@@..@@.@@.@@.@@.@@@.@..
@@@...@.@@@@@.@@..@.@.@@@@@@@@.@@.@.@.@@..@@..@@@@@@@@@@.@@@@..@@.@@@@@@@@@.@.@@....@@@@.@@@@@.@@@..@@@@@@@@..@@@@@@@@@.@@..@.@@@@..@...@
@@@@@@@@.@@@@@@@@@@@@@@....@..@@.@.@@@.@@@@@@@@@@.@@.@@@@@@@@.@....@..@@.@@@.@...@@@@.@@@@@@.@@@@..@@@@.@@..@.@@.@@@@.@.@@@..@@@@@@@@@@.@
...@@..@.@@@@@@.@@@..@.@@.@@..@@..@.@@@.@.@.@@@@@@.@@@@@@.@@@.@@@@.@@@@..@.@@@.@...@@.@....@@@.@@@@@@.@@..@@.@@@.@.@@.@.@.@@@@.@.@@.@@..@"""

read : DataSource -> String
read dataSource = 
  case dataSource of 
    Input -> input
    Sample -> sample

initModel : DataSource -> Model 
initModel dataSource = 
  let 
    data = read dataSource
    symbolLists = data |> String.split "\n" |> List.map String.toList
    rolls = 
      symbolLists 
      |> List.indexedMap (\y -> \lst -> lst |> List.indexedMap (\x -> \sym -> (sym, (x, y))) |> List.filter (\(sym, pos) -> sym == '@'))
      |> List.concat
      |> List.map Tuple.second
      |> Set.fromList
    width = symbolLists |> List.head |> Maybe.withDefault [] |> List.length 
    height = symbolLists |> List.length 
  in 
    { dataSource = dataSource
    , width = width 
    , height = height
    , rolls = rolls
    , removed = 0
    , paused = True
    , finished = False  
    , tickInterval = defaultTickInterval 
    , message = "?" }

init : () -> (Model, Cmd Msg)
init _ =
  (initModel Input, Cmd.none)

-- UPDATE

type Msg = 
  Tick 
  | Step 
  | TogglePlay 
  | Faster 
  | Slower 
  | Clear 
  | UseInput
  | UseSample

getNestedPositions : Int -> Int -> List (List Pos)
getNestedPositions rows columns = 
  let
    ys = List.range 0 (rows - 1) 
    xs = List.range 0 (columns - 1)
  in 
    ys |> List.map (\y -> xs |> List.map (\x -> (x, y)))

updateClear : Model -> Model
updateClear model = 
  initModel model.dataSource

inaccessible : Set Pos -> Pos -> Bool 
inaccessible rolls (x, y) =
  let 
    neighbours = [(x-1, y-1), (x, y-1), (x+1, y-1), (x-1, y), (x+1, y), (x-1, y+1), (x, y+1), (x+1, y+1)]
    count = neighbours |> List.filter (\p -> Set.member p rolls) |> List.length 
  in 
    count >= 4

remove : Set Pos -> Set Pos 
remove rolls = 
  rolls |> Set.filter (inaccessible rolls)

updateStep : Model -> Model
updateStep model = 
  let 
    updatedRolls = remove model.rolls 
    removed = Set.size model.rolls - Set.size updatedRolls 
  in 
    if removed > 0 then 
      { model | rolls = updatedRolls, removed = model.removed + removed }
    else 
      { model | finished = True }

updateTogglePlay : Model -> Model
updateTogglePlay model = 
  { model | paused = not model.paused }

update : Msg -> Model -> (Model, Cmd Msg)
update msg model =
  case msg of
    Clear -> 
      (updateClear model, Cmd.none)
    Tick ->
      (updateStep model, Cmd.none)
    Step ->
      (updateStep model, Cmd.none)
    Faster -> 
      ({model | tickInterval = model.tickInterval / 2 }, Cmd.none)
    Slower -> 
      ({model | tickInterval = model.tickInterval * 2 }, Cmd.none)
    TogglePlay -> 
      (updateTogglePlay model, Cmd.none)
    UseInput -> 
      (initModel Input, Cmd.none)
    UseSample -> 
      (initModel Sample, Cmd.none)

-- SUBSCRIPTIONS

subscriptions : Model -> Sub Msg
subscriptions model =
  let 
    tickSub = if model.paused then Sub.none else Time.every model.tickInterval (\_ -> Tick)
  in 
    tickSub

-- VIEW

toCharElement : String -> Html Msg 
toCharElement symbol = 
  let
    cssClass = 
      case symbol of 
        "." -> "draw-empty adaptive"
        _ -> "draw adaptive"
  in
    Html.span [ Html.Attributes.class cssClass ]  [ Html.text symbol ]

view : Model -> Document Msg
view model = 
  { title = "Advent of Code 2025 | Day 4: Printing Department"
  , body = [ viewBody model ] }

selectSymbol : Set Pos -> Pos -> String 
selectSymbol rolls pos = 
  if Set.member pos rolls then "@" else "."

viewBody : Model -> Html Msg
viewBody model =
  let
    nestedPositions = getNestedPositions model.height model.width 
    nestedElements = 
      nestedPositions |> List.map (\row -> row |> List.map (\pos -> toCharElement (selectSymbol model.rolls pos)))
    elements = nestedElements |> List.foldr (\a b -> List.append a (Html.br [] [] :: b)) []    
    textFontSize =
      case model.dataSource of 
        Sample -> "24px"
        Input -> "8px"  in 
    Html.table 
      [ Html.Attributes.align "center"
      , Html.Attributes.style "width" "100%"
      , Html.Attributes.style "font-family" "Courier New" ]
      [ Html.tr 
          [] 
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "font-family" "Courier New"
              , Html.Attributes.style "font-size" "32px"
              , Html.Attributes.style "padding" "10px"]
              [ Html.div [] [Html.text "Advent of Code 2025" ]
              , Html.div [] [Html.text "Day 4: Printing Department" ] ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "padding-bottom" "10px" ]
              [ Html.a 
                [ Html.Attributes.href "https://adventofcode.com/2025/day/4" ] 
                [ text "https://adventofcode.com/2025/day/4" ]
            ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center" ]
              [ 
                Html.input 
                [ Html.Attributes.type_ "radio", onClick UseInput, Html.Attributes.checked (model.dataSource == Input) ] 
                []
              , Html.label [] [ Html.text "Input" ]
              , Html.input 
                [ Html.Attributes.type_ "radio", onClick UseSample, Html.Attributes.checked (model.dataSource == Sample) ] 
                []
              , Html.label [] [ Html.text "Sample" ]
            ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "padding" "10px" ]
              [ Html.button 
                [ Html.Attributes.style "width" "80px", onClick Clear ] 
                [ text "Reset" ]
              , Html.button 
                [ Html.Attributes.style "width" "80px", onClick Slower ] 
                [ text "Slower" ]
              , Html.button 
                [ Html.Attributes.style "width" "80px", onClick TogglePlay ] 
                [ if model.paused then text "Play" else text "Pause" ] 
              , Html.button 
                [ Html.Attributes.style "width" "80px", onClick Faster ] 
                [ text "Faster" ]
              , Html.button 
                [ Html.Attributes.style "width" "80px", onClick Step ] 
                [ Html.text "Step" ]
            ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "font-family" "Courier New"
              , Html.Attributes.style "font-size" "1.2rem"
              , Html.Attributes.style "padding-top" "10px" ] 
              [ 
                Html.div [] [ Html.text ("Removed: " ++ String.fromInt model.removed)]
              ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "font-family" "Source Code Pro, monospace"
              , Html.Attributes.style "font-size" textFontSize
              , Html.Attributes.style "padding" "10px" ] 
              [ 
                Html.div [
                  Html.Attributes.align "center" 
                , Html.Attributes.style "max-width" "100%"
                ] elements
              ] ] ]

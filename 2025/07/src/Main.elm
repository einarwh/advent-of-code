module Main exposing (..)

{- Advent of Code 2025. Day 07: Laboratories. -}

import Browser 
import Html exposing (Html)
import Html.Attributes
import Html.Events exposing (onClick)
import Set exposing (Set)
import Dict exposing (Dict)
import Time

defaultTickInterval : Float
defaultTickInterval = 50

chamberWidth : Int 
chamberWidth = 7 

-- MAIN

main =
  Browser.element
    { init = init
    , view = view
    , update = update
    , subscriptions = subscriptions }

-- MODEL

type DataSource = Input | Sample

type alias Pos = (Int, Int)

type alias State = 
  { count : Int 
  , seen : Set Pos }

type alias Model = 
  { dataSource : DataSource
  , steps : List State 
  , accumulated : State  
  , lines : List (List Char) 
  , solved : Bool  
  , quantum : Bool 
  , paused : Bool 
  , finished : Bool 
  , tickInterval : Float 
  , debug : String }

sample : String
sample = """.......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
..............."""

input : String
input = """......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^...^....................................................................
.............................................................................................................................................
...................................................................^.^.^.^...................................................................
.............................................................................................................................................
..................................................................^.^.^...^..................................................................
.............................................................................................................................................
.................................................................^.^.^.^.^.^.................................................................
.............................................................................................................................................
................................................................^.^.^.^.^...^................................................................
.............................................................................................................................................
...............................................................^.^.^...^.^.^.^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^.^...^.^..............................................................
.............................................................................................................................................
.............................................................^.^.......^...^.^.^.............................................................
.............................................................................................................................................
............................................................^.^.^.^.^...^.^.^.^.^............................................................
.............................................................................................................................................
...........................................................^.^.^.^.^.^.^.^...^.^.^...........................................................
.............................................................................................................................................
..........................................................^.....^.^.^.^.......^.^.^..........................................................
.............................................................................................................................................
.........................................................^...^.^.^.^.^...^.^.^.....^.........................................................
.............................................................................................................................................
........................................................^.....^.^.....^.^.^.^.....^.^........................................................
.............................................................................................................................................
.......................................................^...^.^.^.......^...^...^.^.^.^.......................................................
.............................................................................................................................................
......................................................^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^......................................................
.............................................................................................................................................
.....................................................^.^.^.^...^...^...........^.^.^.^.^.....................................................
.............................................................................................................................................
....................................................^.^...^.^.....^.^...^.^.^.^.^...^...^....................................................
.............................................................................................................................................
...................................................^.^...^...^...^...^.^.^.^.^...^.^.^.^.^...................................................
.............................................................................................................................................
..................................................^.....^.^.....^.^.^.^.^.^...^.^.....^.^.^..................................................
.............................................................................................................................................
.................................................^.^.^...^.^.^.....^.^.^.^.^.....^.^.^...^.^.................................................
.............................................................................................................................................
................................................^...^...^...^.^.^.........^.^.^.^.^.^.......^................................................
.............................................................................................................................................
...............................................^.^.^.^...^.^.^.......^.^.........^.^.^.^.....^...............................................
.............................................................................................................................................
..............................................^.^.^...^.^.^.^.^.^...^.^.....^.......^.^.^...^.^..............................................
.............................................................................................................................................
.............................................^.^.^.^.^.^...^.^.^.....^.^.^.^.^.^.^.....^.^.^.^.^.............................................
.............................................................................................................................................
............................................^.^.^...^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.^...^.^.^............................................
.............................................................................................................................................
...........................................^.^.^.^.^.^.^.^.^.^...^.^.............^.^.^.........^.^...........................................
.............................................................................................................................................
..........................................^.^.^.....^.^.^.^...^.^.^.^.^.^...^.^.^.^.^.^...^.^.^...^..........................................
.............................................................................................................................................
.........................................^.^...^.^.^.^.^.^.......^.^...^.^.^.^...^...^.^.^...^.^.^.^.........................................
.............................................................................................................................................
........................................^.^.^.^.^.^...^...^.^.^.....^.^.^...^.^.^.^.^.^...^.^.^...^.^........................................
.............................................................................................................................................
.......................................^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.......^...^.^...^.^.^...^.......................................
.............................................................................................................................................
......................................^.^.^.^...^.^...^.^.^.^.^.^.^.^.^.....^.^...^.^.....^.^.^...^...^......................................
.............................................................................................................................................
.....................................^.^.^.^.^.^.^.^...^.^.^...^.....^.^...^.^.^.^.....^.^...^...^.^.^.^.....................................
.............................................................................................................................................
....................................^...^.^.^.....^.^.^.^.^...^...^...^.^.^.^.^.^.^...^.^.^.^.^...^...^.^....................................
.............................................................................................................................................
...................................^...^...^...^.^.^.....^.^...^.^.^.^.^.....^.^.^.^.^.^.....^...^.^.^...^...................................
.............................................................................................................................................
..................................^.^.^.^.^...^.....^.....^.......^.^.....^.^...^...^.^.^...^.....^.^.^.^.^..................................
.............................................................................................................................................
.................................^.^.....^.^.^.^.......^.......^.^.^.^.^.^...^.^...^.^.^...^...^.^...^.....^.................................
.............................................................................................................................................
................................^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.....^.^.^.....^.^.^.^...^.....^................................
.............................................................................................................................................
...............................^.^...^.^.^...^...^.^.....^.....^.^.^.^...^.....^...^...^...^.^.^.^.^.....^.^.^...............................
.............................................................................................................................................
..............................^.^.....^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.......^.^.^.....^...^...^.^..............................
.............................................................................................................................................
.............................^.^.^.^.........^.....^.^.^...^...^.^.^.^.^...^...^.^.^.^.^.^.^...^.^.^.^...^.^...^.............................
.............................................................................................................................................
............................^.^.^.^.^.^.^.^...^.^.....^.^...^.^.^.^.^.....^.^.^.^...^.^.^.^.^...^...^...^...^.^.^............................
.............................................................................................................................................
...........................^.^...^.^.^.^.^.^...^.^.^.....^...^.^.^.^.^...^...^.^...^.^.......^.^.^...^.^.^.^.^.^.^...........................
.............................................................................................................................................
..........................^.^...^.^.^.^.^.^.^.........^.^...^.^.^.^.^.^.^.......^.^.^...^.^...^...^.^.^.^.^...^.^.^..........................
.............................................................................................................................................
.........................^.....^.^.^.^.^.^...^.^.^.^.....^.^.^...^.^.....^.^.^.^.^.^...^...^.^.....^.^.....^.^.^.^.^.........................
.............................................................................................................................................
........................^...^...^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.....^.^...^...^...^.^.^.^.^.^.......^.^.^.^.^...^........................
.............................................................................................................................................
.......................^.^.^...^.^.......^.^.^.^.^.^...^.^.......^.^.^...^.^...^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.^.^.^.......................
.............................................................................................................................................
......................^.^.^.^...^.^.^.^.^.^.^...^.......^.^...^...^...^...^...^...^.....^...^.^.^.^...^.^.^...^.^.^.^.^......................
.............................................................................................................................................
.....................^.^.^...^.^...^.^...^.....^...^.^.^.^.....^.^...^.^.^.^.....^...^.......^.^.^...^.....^.^.^.....^.^.....................
.............................................................................................................................................
....................^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.....^...^.^.^.^.^...^.^.^.^.^.^.^...^.^.......^...^.^.^.^.^.^.^.....^....................
.............................................................................................................................................
...................^.^.....^.....^...^.^...^...^...^.^.^...^.......^.^...^...^.^.^.^.^.^.^.^...^.^.^.^.^...^.^...^...^.^.^...................
.............................................................................................................................................
..................^...^.^.^.^.^.^.^.^.^.^.^.^.....^...^...^...^.^.^.^.^.^.^.^.^...^.....^...^...^.^.^.^.^.....^...^.^.^.^.^..................
.............................................................................................................................................
.................^.^.^.^.....^...^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.....^.^.^...^.^.^...^.......^.....^.^...^...^.......^.^.................
.............................................................................................................................................
................^.^...^.....^.^...^.^...^.^.^...^.^.^.^...^.^.^.^.....^.^...^.^...^.^...^.^.....^.^.^.....^.^.^.^.^.^...^...^................
.............................................................................................................................................
...............^.^.....^.^.^.^.^.^.^.^...^.^...^.^...^.^.^...^.^.....^.^...^.^.^.^.^.........^.^...^.^.^...^.^.^.....^...^.^.^...............
.............................................................................................................................................
..............^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.........^.^.^.^.^...^.^.^.^..............
.............................................................................................................................................
.............^.^.^.^.^.^...^.^.^.^...^.^.^.^.^.........^.^...^.^.^.....^.^...^.^.^...^.^.^...^.^...^...^...^...^.^.^.^.^.^...^.^.............
.............................................................................................................................................
............^.^.....^.^...^.^.^.^.......^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^...^.^...^.^.^...^.^.^.^.^.^.^...^............
.............................................................................................................................................
...........^.^.^...^.^.^.^.^...^...^.^.^.....^.^...^.^.^...^.^.^...^.^.^.^...^...^.^.....^...^.^.....^.^.^.^.^.^.^.^...^.......^.^...........
.............................................................................................................................................
..........^.^.^.^.^.^...^...^.^.^.^.^.^.....^.^.^.^.^...^...^.^.^...^.^.^.^.^...^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.....^.^.^.......^..........
.............................................................................................................................................
.........^.^.^.^.^...^.^...^...^.....^.^...^.^...^.^.^.^.^.^.........^.^.^.^.^...^.^.^...^.^.^.^.^...^.....^.^.^.^.^.^.^.^.^.^.^...^.........
.............................................................................................................................................
........^...^.....^.^.......^...^.^.^.^.....^.^.^.^.......^.^...^.^.^.^.^.^.^.^.^.^.^.....^...^.^.....^...^.^.^.^.^...^...^.....^.^.^........
.............................................................................................................................................
.......^.^.^.^.^.^...^.^.^...^.^...^...^.......^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.....^.^.^.^...^.^.^.......
.............................................................................................................................................
......^.^.^.^.......^.^.^.^.....^.^.^...^.^.^.^.^...^...^...^.^.^.........^.....^.^.^.^.^.^.....^.......^.^.......^.....^.^.^.^.^.....^......
.............................................................................................................................................
.....^.^.^.^.....^.^.^...^...^.......^.^...^.....^.^.^.^.^...^...^.^.^.^...^.^.^.^.^.^.^.^.^...^.......^...^.........^.^.^.^...^.^...^.^.....
.............................................................................................................................................
....^.^.^.^.^.^.^.^.^.^...^.^...^.^.^...^.^.^.^...^.^...^.^.^.^...^...^.^.^.^.^.^.^...^.^.^...^.......^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^....
.............................................................................................................................................
...^...^.^.^.^...^.^...^.^.....^.^.^.^.^.^.^.^.^.....^.^.^...^...^.^.^.^.^...^...^.^.^.^...^.^.^.^.^...^...^.^.^.^.^...^.^.^.^.....^.....^...
.............................................................................................................................................
..^.^...^...^.^.^.^...^.^.^...^.^.^.^.^.....^...^...^.^.^.....^.^.....^.^.^...^.....^.^...^.^.^.^...^.......^.^.....^.^.......^.^.......^.^..
.............................................................................................................................................
.^...^.^.^.^.^.^.....^.^.^.........^.^...^.^.^.^...^.^.^.^...^.^.........^.^...^.....^...^.^.^.^.^.^.^...^...^.^.^.........^.^.^.^.^.^.^.^.^.
............................................................................................................................................."""

read : DataSource -> String
read dataSource = 
  case dataSource of 
    Input -> input
    Sample -> sample

initModel : Bool -> DataSource -> Model 
initModel quantum dataSource = 
  let 
    data = read dataSource
    lines = data |> String.split "\n" |> List.map String.toList
  in 
    { dataSource = dataSource
    , steps = []
    , accumulated = { count = 0, seen = Set.empty }
    , lines = lines
    , solved = False
    , quantum = quantum
    , paused = True
    , finished = False  
    , tickInterval = defaultTickInterval 
    , debug = "?" }

init : () -> (Model, Cmd Msg)
init _ =
  (initModel False Input, Cmd.none)

-- UPDATE

type Msg = 
  Tick 
  | Step 
  | TogglePlay 
  | ToggleQuantum
  | Faster 
  | Slower 
  | Clear 
  | UseInput
  | UseSample

getNestedPositions : Int -> Int -> List (List Pos)
getNestedPositions rows columns = 
  let
    ys = List.range 0 (rows - 1) 
    xs = List.range 0 (columns - 1)
  in 
    ys |> List.map (\y -> xs |> List.map (\x -> (x, y)))

updateClear : Model -> Model
updateClear model = 
  initModel model.quantum model.dataSource

updateStep : Model -> Model
updateStep model = 
  if model.solved then 
    case model.steps of 
      [] -> { model | paused = True, finished = True, solved = False }
      step :: rest -> 
        let 
          a = model.accumulated
          nextAcc = { count = step.count, seen = Set.union a.seen step.seen }
          debug = model.steps |> List.length |> String.fromInt 
        in 
          { model | steps = rest, accumulated = nextAcc, debug = debug }
  else 
    let 
      steps = solve model.quantum model.lines 
      debug = steps |> List.length |> String.fromInt
      m = { model | solved = True, steps = steps, accumulated = { count = 0, seen = Set.empty }, debug = debug }
    in 
      updateStep m 

prevState : List State -> State 
prevState acc = 
  acc |> List.head |> Maybe.withDefault { count = 0, seen = Set.empty }

timelineCount : List State -> Dict Pos Int -> Int -> Int -> List (List Char) -> (Dict Pos Int, List State, Int) 
timelineCount acc mem beam depth lines = 
  let 
    prev = prevState acc 
  in 
    case Dict.get (beam, depth) mem of 
      Just cached ->
        let 
          st = { count = prev.count + cached, seen = prev.seen }
        in 
          (mem, st :: acc, cached) 
      Nothing -> 
        case lines of 
          [] -> 
            let 
              st = { count = prev.count + 1, seen = prev.seen }
            in 
              (mem, st :: acc, 1) 
          h :: t -> 
            let 
              indexes = 
                h |> List.indexedMap (\i -> \c -> (i, c)) 
                  |> List.filterMap (\(i, c) -> if c == '^' then Just i else Nothing)
            in 
              if indexes |> List.member beam then 
                let 
                  seen0 = prev.seen |> Set.insert (beam, depth) |> Set.insert (beam - 1, depth)
                  state0 = { count = prev.count, seen = seen0 }
                  acc0 = state0 :: acc
                  (memL, accL, countL) = timelineCount acc0 mem (beam - 1) (depth + 1) t 
                  prevL = prevState accL 
                  seen1 = prevL.seen |> Set.insert (beam + 1, depth)
                  state1 = { count = prevL.count, seen = seen1 }
                  acc1 = state1 :: accL
                  (memR, accR, countR) = timelineCount acc1 memL (beam + 1) (depth + 1) t 
                  prevR = prevState accR 
                  seen2 = prevR.seen 
                  state2 = { count = prevR.count, seen = seen2 }
                  acc2 = state2 :: accR
                  totalCount = countL + countR 
                  nextMem = memR |> Dict.insert (beam, depth) totalCount 
                in 
                  (nextMem, accR, totalCount) 
              else 
                let
                  seen0 = prev.seen |> Set.insert (beam, depth) 
                  state0 = { count = prev.count, seen = seen0 }
                  acc0 = state0 :: acc
                  (m, a, c) = timelineCount acc0 mem beam (depth + 1) t
                  -- afterState = { count = prev.count, seen = Set.empty }
                in 
                  (m, a, c)

compact : List State -> List State 
compact steps = 
  case steps of 
    a :: b :: rest -> 
      if Set.size b.seen == Set.size a.seen then 
        b :: compact rest 
      else 
        a :: compact (b :: rest)
    _ -> steps

timeline : Int -> List (List Char) -> List State 
timeline beam lines = 
  let 
    initState = { count = 0, seen = Set.empty |> Set.insert (beam, 0) }
    acc = [ initState ]
    mem = Dict.empty 
    depth = 0
    (_, result, _) = timelineCount acc mem beam depth lines 
  in 
    result |> List.reverse |> compact

splitCount : List State -> Set Int -> Int -> List (List Char) -> List State
splitCount acc beams depth lines = 
  case lines of 
    [] -> acc |> List.reverse 
    h :: t -> 
      let 
        indexes = 
          h |> List.indexedMap (\i -> \c -> (i, c)) 
            |> List.filterMap (\(i, c) -> if c == '^' then Just i else Nothing)
        collisions = beams |> Set.filter (\b -> indexes |> List.member b)
        uncollisions = Set.diff beams collisions
        splitBeams = Set.union (collisions |> Set.map (\b -> b - 1)) (collisions |> Set.map (\b -> b + 1))
        nextBeams = uncollisions |> Set.union splitBeams 
        seen = nextBeams |> Set.union collisions |> Set.map (\b -> (b, depth))
        count = acc |> List.head |> Maybe.map (\st -> st.count) |> Maybe.withDefault 0 
        state = { count = count + Set.size collisions, seen = seen }
      in 
        splitCount (state :: acc) nextBeams (depth + 1) t 

indexOf : Int -> a -> List a -> Maybe Int 
indexOf ix it lst =
  case lst of 
    [] -> Nothing 
    h :: t -> 
      if h == it then Just ix else indexOf (ix + 1) it t 

solve : Bool -> List (List Char) -> List State 
solve quantum lines = 
  case lines of 
    [] -> [] 
    h :: t -> 
      case indexOf 0 'S' h of 
        Nothing -> []
        Just ix -> 
          if quantum then 
            timeline ix lines 
          else 
            let 
              initState = { count = 0, seen = Set.empty |> Set.insert (ix, 0) }
              beams = Set.empty |> Set.insert ix 
            in 
              splitCount [ initState ] beams 0 lines 

updateTogglePlay : Model -> Model
updateTogglePlay model = 
  if model.finished then 
    updateTogglePlay (initModel model.quantum model.dataSource)
  else if model.paused then 
    { model | paused = False }
  else 
    { model | paused = True }

updateToggleQuantum : Model -> Model
updateToggleQuantum model = 
  { model | quantum = not model.quantum }

update : Msg -> Model -> (Model, Cmd Msg)
update msg model =
  case msg of
    Clear -> 
      (updateClear model, Cmd.none)
    Tick ->
      (updateStep model, Cmd.none)
    Step ->
      (updateStep model, Cmd.none)
    Faster -> 
      ({model | tickInterval = model.tickInterval / 2 }, Cmd.none)
    Slower -> 
      ({model | tickInterval = model.tickInterval * 2 }, Cmd.none)
    TogglePlay -> 
      (updateTogglePlay model, Cmd.none)
    ToggleQuantum -> 
      (updateToggleQuantum model, Cmd.none)
    UseInput -> 
      (initModel model.quantum Input, Cmd.none)
    UseSample -> 
      (initModel model.quantum Sample, Cmd.none)

-- SUBSCRIPTIONS

subscriptions : Model -> Sub Msg
subscriptions model =
  let 
    tickSub = if model.paused then Sub.none else Time.every model.tickInterval (\_ -> Tick)
  in 
    tickSub

-- VIEW

toCharElement : Set Pos -> Pos -> String -> Html Msg 
toCharElement seen pos symbol = 
  let
    cssClass =
      if Set.member pos seen then 
        if symbol == "^" || symbol == "S" then "draw-red adaptive" else "draw-green adaptive"
      else 
        "draw-empty adaptive"
    sym = 
      if symbol == "." && Set.member pos seen then 
        "|"
      else
        symbol  
  in
    Html.span [ Html.Attributes.class cssClass ]  [ Html.text sym ]

selectSymbol : Set Pos -> Pos -> String 
selectSymbol rolls pos = 
  if Set.member pos rolls then "@" else "."

view : Model -> Html Msg
view model =
  let
    seen = model.accumulated.seen
    nestedElements = 
      model.lines |> List.indexedMap (\y -> \line -> line |> List.indexedMap (\x -> \ch -> toCharElement seen (x, y) (String.fromChar ch)))
    elements = nestedElements |> List.foldr (\a b -> List.append a (Html.br [] [] :: b)) []    
    textFontSize =
      case model.dataSource of 
        Sample -> "24px"
        Input -> "8px"  in 
    Html.table 
      [ Html.Attributes.align "center"
      , Html.Attributes.style "width" "100%"
      , Html.Attributes.style "font-family" "Courier New" ]
      [ Html.tr 
          [] 
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "font-family" "Courier New"
              , Html.Attributes.style "font-size" "32px"
              , Html.Attributes.style "padding" "10px"]
              [ Html.div [] [Html.text "Advent of Code 2025" ]
              , Html.div [] [Html.text "Day 7: Laboratories" ] ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "padding-bottom" "10px" ]
              [ Html.a 
                [ Html.Attributes.href "https://adventofcode.com/2025/day/7" ] 
                [ Html.text "https://adventofcode.com/2025/day/7" ]
            ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center" ]
              [ 
                Html.input 
                [ Html.Attributes.type_ "radio", onClick UseInput, Html.Attributes.checked (model.dataSource == Input) ] 
                []
              , Html.label [] [ Html.text "Input" ]
              , Html.input 
                [ Html.Attributes.type_ "radio", onClick UseSample, Html.Attributes.checked (model.dataSource == Sample) ] 
                []
              , Html.label [] [ Html.text "Sample" ]
            ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "padding" "10px" ]
              [ Html.button 
                [ Html.Attributes.style "width" "80px", onClick Clear ] 
                [ Html.text "Reset" ]
              , Html.button 
                [ Html.Attributes.style "width" "80px", onClick Slower ] 
                [ Html.text "Slower" ]
              , Html.button 
                [ Html.Attributes.style "width" "80px", onClick TogglePlay ] 
                [ if model.paused then Html.text "Play" else Html.text "Pause" ] 
              , Html.button 
                [ Html.Attributes.style "width" "80px", onClick Faster ] 
                [ Html.text "Faster" ]
              , Html.button 
                [ Html.Attributes.style "width" "80px", onClick Step ] 
                [ Html.text "Step" ]
            ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center" ]
              [ Html.input 
                [ Html.Attributes.type_ "checkbox", onClick ToggleQuantum, Html.Attributes.checked model.quantum ] 
                []
              , Html.label [] [ Html.text " Quantum Manifold" ]
            ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "font-family" "Courier New"
              , Html.Attributes.style "font-size" "16px"
              , Html.Attributes.style "padding-top" "10px" ] 
              [ 
                Html.div [] [ Html.text (String.fromInt model.accumulated.count) ]
              ] ]
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "font-family" "Source Code Pro, monospace"
              , Html.Attributes.style "font-size" textFontSize
              , Html.Attributes.style "padding" "10px" ] 
              [ 
                Html.div [
                  Html.Attributes.align "center" 
                , Html.Attributes.style "max-width" "100%"
                ] elements
              ] ] 
      , Html.tr 
          []
          [ Html.td 
              [ Html.Attributes.align "center"
              , Html.Attributes.style "font-family" "Source Code Pro, monospace"
              , Html.Attributes.style "font-size" "16px"
              , Html.Attributes.style "padding" "0px" ] 
              [ 
                -- Html.div [] [ Html.text (model.moves |> List.length |> String.fromInt ) ]
              -- , Html.div [] [ Html.text (String.fromInt model.position) ]
                Html.div [] [ Html.text (model.steps |> List.length |> String.fromInt) ]
              -- , Html.div [] [ Html.text model.message ]
              ] ] 
              ]
